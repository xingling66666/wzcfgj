<!DOCTYPE html>
<html lang="zh-CN">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
      <link crossorigin="anonymous" rel="shortcut icon" type="image/x-icon" href="images/logo.png">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
      <link rel="stylesheet" href="https://unpkg.com/mdui@2.1.4/mdui.css">
      <script src="https://unpkg.com/mdui@2.1.4/mdui.global.js"></script>
      <link href="https://fonts.googleapis.cn/icon?family=Material+Icons" rel="stylesheet">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script>
      /*
Object.defineProperty(navigator, 'userAgent', {
    value: 'Mozilla/5.0 (Linux; Android 15; 24069RA21C Build/AQ3A.240912.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/121.0.6167.71 MQQBrowser/6.2 TBS/047919 Mobile Safari/537.36 V1_AND_SQ_9.2.20_11650_YYB_D QQ/9.2.20.30025 NetType/WIFI WebP/0.3.0 AppId/537315791 Pixel/1220 StatusBarHeight/106 SimpleUISwitch/0 QQTheme/1000 StudyMode/0 CurrentMode/0 CurrentFontScale/1.0 GlobalDensityScale/1.0166667 AllowLandscape/false InMagicWin/0',
    configurable: true
});
*/
         if (navigator.userAgent.indexOf("MicroMessenger") !== -1) {
             document.write('<iframe id="fullscreen-iframe" src="about:blank" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; margin: 0; padding: 0; overflow: hidden; z-index: 999999;"></iframe>');
             const iframe = document.getElementById("fullscreen-iframe");
             iframe.src = window.location.origin + "/openurl.html";
         }
         window.gametype = null
         
         var url = window.location.href.split(/\?data=(.+)/)[1];
         var gamesplit_str = "?gamedata="
         var gamesplit = window.url.split(gamesplit_str)
         if (gamesplit) {
             window.gameurl = gamesplit[0];
             window.game_base64data = gamesplit[1].split("SmobaLaunch_")[1];
             var zsfappsdk = "tencentmsdk1104466820://"
             var tyfappsdk = "tencentmsdk1104791911://"
             var gjfappsdk = "tencent102083272://"
         
             if (gameurl == zsfappsdk) {
                 window.gametype = "正式服"
                 if (navigator.userAgent.indexOf("QQ/") !== -1) {
                     window.gameurl = gameurl.replace(new RegExp(zsfappsdk, 'g'), 'https://h5.nes.smoba.qq.com/pvpesport.web.user/#/launch-game-mp-qq');
                 }
             } else if (gameurl == tyfappsdk) {
                 window.gametype = "体验服"
                 if (navigator.userAgent.indexOf("QQ/") !== -1) {
                     document.write('<iframe id="fullscreen-iframe" src="about:blank" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; margin: 0; padding: 0; overflow: hidden; z-index: 999999;"></iframe>');
                     const iframe = document.getElementById("fullscreen-iframe");
                     iframe.src = window.location.origin + "/openurl.html";
                 }
             }
             else if(gameurl == gjfappsdk) {
             	window.gametype = "国际服"
                 if (navigator.userAgent.indexOf("QQ/") !== -1) {
                     document.write('<iframe id="fullscreen-iframe" src="about:blank" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; margin: 0; padding: 0; overflow: hidden; z-index: 999999;"></iframe>');
                     const iframe = document.getElementById("fullscreen-iframe");
                     iframe.src = window.location.origin + "/openurl.html";
             }
             }
         
         } else {
             window.gametype = null
         }
         
      </script>
      <title>房间加入</title>
      <style data-emotion="css" data-s="">
:root {
  /* 颜色变量 */
  --primary-blue: #1e88e5;
  --dark-blue: #0d47a1;
  --blue-button: #4e97ff;
  --red-button: #ff3e78;
  --text-dark: #333;
  --text-light: #fff;
  --text-gray: #555;
  --bg-light: #f5f7fa;
  --card-border: rgba(229, 225, 225, 0.3);
  --card-bg: rgba(255, 255, 255, 0.15);
}

/* 基础重置 */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  width: 100%;
  overflow-x: hidden;
  line-height: 1.5;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  color: var(--text-gray);
  background-color: var(--bg-light);
}

/* 容器布局 */
.container {
  max-width: 600px;
  width: 100%;
  padding: 0 15px;
  margin: 20px auto;
  position: relative;
}

/* 卡片样式 */
.card {
  width: 100%;
  padding: 20px;
  margin-bottom: 20px;
  border: 2px solid var(--card-border);
  border-radius: 16px;
  background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
  color: var(--text-light);
  box-shadow: 0 4px 12px rgba(30, 136, 229, 0.2);
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(30, 136, 229, 0.3);
}

.cardhh {
  margin: 20px 0;
  width: 100%;
  padding: 20px;
  border: 2px solid var(--primary-blue);
  border-radius: 16px;
  background: transparent;
  color: var(--text-dark);
}

/* 文本样式 */
.mytext {
  font-size: 1.5rem;
  font-weight: 300;
  margin-bottom: 15px;
  text-align: center;
  color: var(--text-dark);
}

.card-title {
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 12px;
  text-align: left;
  color: var(--text-light);
}

.card-title-two {
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 12px;
  text-align: left;
  color: var(--red-button);
}

.title {
  letter-spacing: 0.8px;
  padding: 5px;
  border-radius: 5px;
  color: var(--text-light);
  font-size: 0.9375rem;
  font-weight: 500;
}

.title-two {
  letter-spacing: 0.8px;
  padding: 5px;
  border-radius: 5px;
  color: var(--red-button);
  font-size: 0.9375rem;
  font-weight: 500;
}

/* 链接样式 */
.card-link {
  display: block;
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-decoration: none;
  line-height: 1.5;
  text-align: left;
  border-radius: 8px;
  padding: 12px;
  margin: 10px 0 20px;
  background: var(--card-bg);
  color: var(--text-light);
  font-size: 0.875rem;
  font-weight: 400;
  letter-spacing: 0.3px;
  transition: background 0.3s ease;
}

.card-link:hover {
  background: rgba(255, 255, 255, 0.25);
}

.card-link-two {
  display: block;
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-decoration: none;
  line-height: 1.5;
  text-align: left;
  border-radius: 8px;
  padding: 12px;
  margin: 10px 0 20px;
  background: var(--card-bg);
  color: var(--red-button);
  font-size: 0.875rem;
  font-weight: 400;
  letter-spacing: 0.3px;
}

/* 按钮样式 */
.button {
  display: block;
  border-radius: 30px;
  backdrop-filter: blur(3px);
  border: 1px solid rgba(229, 225, 225, 0.3);
  padding: 12px 20px;
  margin: 10px 0;
  background: rgba(229, 229, 229, 0.42);
  color: var(--text-dark);
  font-weight: 500;
  font-size: 0.9375rem;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.button:hover {
  background-color: #e0e0e0;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* 导航按钮组 */
.button-nav {
  width: 100%;
  display: flex;
  gap: 10px;
  justify-content: center;
  margin: 20px 0;
}

.button-nav .button {
  flex: 1;
  max-width: 160px;
  min-width: 120px;
  white-space: nowrap;
}

.button-nav .button:first-child {
  background-color: var(--blue-button);
  color: white;
}

.button-nav .button:last-child {
  background-color: var(--red-button);
  color: white;
}

/* 详情折叠面板 */
summary {
  padding: 12px;
  margin: 10px 0 15px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

summary:hover {
  background: rgba(255, 255, 255, 0.15);
}

details[open] summary {
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px 8px 0 0;
  margin-bottom: 0;
}

/* 页脚样式 */
.footer {
  text-align: center;
  font-size: 0.75rem;
  margin-top: 30px;
  padding: 20px 0;
  color: #666;
  border-top: 1px solid #eee;
}

.footer p {
  margin-bottom: 8px;
}

/* 响应式调整 */
@media (max-width: 480px) {
  .mytext {
    font-size: 1.25rem;
  }
  
  .card {
    padding: 15px;
  }
  
  .button-nav {
    flex-direction: column;
    align-items: center;
  }
  
  .button-nav .button {
    width: 100%;
    max-width: 100%;
  }
}

/* 动画效果 */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.card {
  animation: fadeIn 0.5s ease forwards;
}

      </style>
   </head>
   <body>
<div class="container">
    <div class="card">
        <div class="nav">
            <div class="card-title">地图模式</div>
            <span class="title"></span>
        </div>
        <div class="card-link"></div>
        <details>
            <summary>查看自定义配置</summary>
            <div class="card-title">房间参数</div>
            <span class="card-link"></span>
            <div class="card-title-two">禁用英雄</div>
            <span class="card-link"></span>
        </details>
    </div>
    
    <div class="more">
        <div class="button-nav">
            <div style="display: flex; justify-content: center; gap: 20px; padding: 0 16px;">
                <div style="text-align: center;">
                    <select id="bluePosition" style="color: #135CCA;padding: 8px; border-radius: 8px; margin-bottom: 10px; width: 160px;">
                        <option value="0">蓝方位置1</option>
                        <option value="1">蓝方位置2</option>
                        <option value="2">蓝方位置3</option>
                        <option value="3">蓝方位置4</option>
                        <option value="4">蓝方位置5</option>
                    </select>
                    <button style="background: #4e97ff; color: white; border: none; padding: 10px 20px; border-radius: 30px; width: 160px;" onclick="addblueWithPosition()">加入蓝方阵营</button>
                </div>
                
                <div style="text-align: center;">
                    <select id="redPosition" style="color: #C71954; padding: 8px; border-radius: 8px; margin-bottom: 10px; width: 160px;">
                        <option value="0">红方位置1</option>
                        <option value="1">红方位置2</option>
                        <option value="2">红方位置3</option>
                        <option value="3">红方位置4</option>
                        <option value="4">红方位置5</option>
                    </select>
                    <button style="background: #ff3e78; color: white; border: none; padding: 10px 20px; border-radius: 30px; width: 160px;" onclick="addredWithPosition()">加入红方阵营</button>
                </div>
            </div>
        </div>
    </div>
         
         <div class="cardhh" style="background: linear-gradient(135deg,);">
            <mdui-button onclick='qun()' style="background-color: #2370C2" icon="group">官方群</mdui-button><br>
            <mdui-button onclick='home()' style="background-color: #2370C2" icon="home">跳转主页</mdui-button><br>
            <mdui-button onclick='exitRoom()' style="background-color: #2370C2" icon="exit_to_app">退出房间</mdui-button>
                   </div>
      </div>
    <div class="footer" style="padding: 20px 0; text-align: center; font-size: 12px; color: #666;">
  <p>部分代码来源于AI生成</p>
  <p>原作者：huaji</p>
</div>

      <script type="text/javascript">
        jQuery(document).ready(function($) {
          $('body').wpSuperSnow({
            flakes: ['images/004.png', 'images/004.png', 'images/003.png', 'images/001.png', 'images/002.png', 'images/003.png', 'images/004.png', 'images/004.png', ],
            totalFlakes: '70',
            zIndex: '999999',
            maxSize: '80',
            maxDuration: '60',
            useFlakeTrans: true
          });
        });
      </script><!--漂浮-->
      <script src="myjson.js"></script>
      <script>
         const images = [
          {url: '/bg', position: 'center'}
          ];
         const randomImage = images[Math.floor(Math.random() * images.length)];
         document.documentElement.style.setProperty('--background-url', `url(${randomImage.url})`);
         document.documentElement.style.setProperty('--background-position', randomImage.position);
           window.top.postMessage({ title: document.title, url: window.location.href }, '*');
           
           var alltip = document.getElementsByClassName("card-link")
           var title = document.getElementsByClassName("title")
           var mapnametable = {};
           var maptable = mydatajson[0]
           
           for (const key in maptable) {
               const valueArray = maptable[key];
               mapnametable[valueArray[0]] = [key, valueArray[2]];
           }
           /*补全地图模式*/
           /*
           mapnametable[1010] = ["快速赛", 10]
           mapnametable[20031] = ["小峡谷", 10]
           mapnametable[25001] = ["1v1对抗路", 2]
           mapnametable[25002] = ["1v1中路", 2]
           mapnametable[25003] = ["1v1发育路", 2]
           mapnametable[20910] = ["5v5征兆0ban位", 10];
           
           mapnametable[20009] = ["火焰山大作战", 10]
           mapnametable[20012] = ["克隆模式", 10]
           mapnametable[20019] = ["契约之战", 10]
           mapnametable[20017] = ["无限乱斗", 10]
           mapnametable[4010] = ["变身大乱斗", 10]
           mapnametable[90001] = ["梦境大乱斗", 10]
           
           
           mapnametable[5121] = ["觉醒之战", 10]
           mapnametable[5153] = ["多重施法", 10]
           mapnametable[5155] = ["双人同舞", 10]
           */
           var gamejson = JSON.parse(atob(game_base64data))
           var banheros = gamejson.banHerosCamp1
           var mapid = gamejson.mapID
           if (mapnametable[mapid]) {
               var mapname = mapnametable[mapid][0]
           } else {
               var mapname = mapid
           }
           
           title[0].innerText = title[0].innerText + gametype
           alltip[0].innerText = mapname
           console.log(mapname)
           var custom = gamejson.customDefineItems
           
           var mycustom_json = {
               "英雄属性": {
                   "初始等级": [
                       ["0", "51", "56", "61", "66", "28", "71", "76", "81", "86"],
                       ["1级", "级", "5级", "8级", "10级", "12级", "15级"]
                   ],
                   "法术攻击": [
                       ["1", "52", "57", "62", "67", "29", "72", "77", "82", "87"],
                       ["无加成", "加10%", "加25%", "加50%", "加75%", "加100%"]
                   ],
                   "物理攻击": [
                       ["2", "53", "58", "63", "68", "30", "73", "78", "83", "88"],
                       ["无加成", "加10%", "加25%", "加50%", "加75%", "加100%"]
                   ],
                   "CD加成": [
                       [["3", "21"], ["54", "91"], ["59", "92"], ["64", "93"], ["69", "94"], ["31", "47"], ["74", "95"], ["79", "96"], ["84", "97"], ["89", "98"]],
                       ["无加成", "减25%", "减40%", "减80%", "减99%"]
                   ],
                   "金币": [
                       ["4", "55", "60", "65", "70", "32", "75", "80", "85", "90"],
                       ["无加成", "1000", "2000", "5000", "12000"]
                   ],
                   "移速": [
                       ["106", "107", "108", "109", "110", "111", "112", "113", "114", "115"],
                       ["无加成", "加10%", "加20%", "加30%"]
                   ]
               },
               "兵线属性": {
                   "攻击力": [
                       ["5", "33"],
                       ["无加成", "加10%", "加25%", "加50%", "加75%", "加100%"]
                   ],
                   "血量": [
                       ["6", "34"],
                       ["无加成", "加10%", "加25%", "加50%", "加75%", "加100%"]
                   ],
                   "移动速度": [
                       ["7", "35"],
                       ["无加成", "加25%", "加50%", "加100%"]
                   ],
                   "刷新速度": [
                       ["8", "36"],
                       ["无加成", "加5%", "加10%", "加15%"]
                   ],
                   "出兵类型": [
                       ["9", "37"],
                       ["普通兵线", "超级兵", "主宰先锋"]
                   ],
                   "出兵路线": [
                       ["10", "38"],
                       [["不出兵"], ["对抗路"], ["中路"], ["对抗路", "中路"], ["发育路"], ["对抗路", "发育路"], ["中路", "发育路"]],
                   ],
               },
           
               "野怪属性": {
                   "攻击力": [
                       ["11", "39"],
                       ["无加成", "加10%", "加25%", "加50%", "加75%", "加100%"]
                   ],
                   "血量": [
                       ["12", "40"],
                       ["无加成", "加10%", "加25%", "加50%", "加75%", "加100%"]
                   ],
               },
               "防御塔属性": {
                   "攻击力": [
                       [["13", "22"], ["41", "48"]],
                       ["无加成", "加25%", "加50%", "加100%"]
                   ],
                   "攻击范围": [
                       [["15", "24"], ["43", "50"]],
                       ["无加成", "加25%", "加50%"]
                   ],
                   "血量": [
                       [["14", "23"], ["42", "49"]],
                       ["无加成", "加25%", "加50%", "加100%"]
                   ],
               },
               "水晶属性": {
                   "攻击力": [
                       ["16", "44"],
                       ["无加成", "加25%", "加50%", "加100%"]
                   ],
                   "血量": [
                       ["17", "45"],
                       ["无加成", "加25%", "加50%", "加100%"]
                   ],
               },
               "胜利条件": {
                   "胜利条件": [
                       [
                           ["19:1"],
                           ["19:1", "103:1"],
                           ["19:1", "103:2"],
                           ["19:2"],
                           ["19:2", "20:1"],
                           ["19:2", "20:2"],
                           ["19:2", "20:3"],
                           ["19:2", "105:1"],
                           ["19:2", "105:1", "104:1"],
                           ["19:2", "105:1", "104:2"],
                       ],
                       ["摧毁任意一个一塔", "摧毁任意一个二塔", "摧毁任意一个三塔", "3个总击败", "20个总击败", "30个总击败", "40个总击败", "1个助攻", "5个助攻", "10个助攻"]
                   ],
               },
           }
           
           

function seturl(campid, addpos = null) {
    var gamejson = JSON.parse(atob(game_base64data)) // 重新解析确保获取最新数据
    
    if (addpos !== null) {
        gamejson.AddPos = addpos.toString(); // 直接使用选择的位置值
    } else {
        delete gamejson.AddPos;
    }
    
    gamejson.AddType = "0"
    gamejson.campid = campid.toString()
    var gamedata = JSON.stringify(gamejson)
    var url = gameurl + gamesplit_str + "SmobaLaunch_" + btoa(gamedata)
    return url
}

function addblueWithPosition() {
    try {
        var positionSelect = document.getElementById('bluePosition');
        var position = parseInt(positionSelect.value); // 确保是数字
        var url = seturl(1, position);
        window.top.location.href = url;
    }
    catch(error) {
        alert("加入失败：" + error);
    }
}

function addredWithPosition() {
    try {
        var positionSelect = document.getElementById('redPosition');
        var position = parseInt(positionSelect.value); // 确保是数字
        
        var url = seturl(2, position);
        window.top.location.href = url;
    }
    catch(error) {
        alert("加入失败：" + error);
    }
}


function getTeamSize() {
    var gamejson = JSON.parse(atob(game_base64data))
    var teamerNum = gamejson.teamerNum;
    console.log('teamerNum值:', teamerNum);
    return teamerNum / 2;
}

function updatePositionSelects() {
    try {
        var teamSize = getTeamSize();
        console.log('队伍人数:', teamSize);
        
        var blueSelect = document.getElementById('bluePosition');
        var redSelect = document.getElementById('redPosition');
        
        // 清空现有选项
        blueSelect.innerHTML = '';
        redSelect.innerHTML = '';
        
        // 生成位置选项
        for (var i = 0; i < teamSize; i++) {
            var blueOption = document.createElement('option');
            blueOption.value = i;
            blueOption.textContent = '蓝方位置' + (i + 1);
            blueSelect.appendChild(blueOption);
            
            var redOption = document.createElement('option');
            redOption.value = i;
            redOption.textContent = '红方位置' + (i + 1);
            redSelect.appendChild(redOption);
        }
        
        console.log('位置下拉菜单更新完成：' + teamSize + 'v' + teamSize);
    } catch (error) {
        console.log('更新位置下拉菜单出错：', error);
        // 延迟重试
        setTimeout(updatePositionSelects, 100);
    }
}

console.log('数据解析完成，开始更新位置下拉菜单...');
updatePositionSelects();


           /*
           function addblue1() {
               var url = seturl(1,"0")
               window.top.location.href = url
           }
           
           function addblue2() {
               var url = seturl(1,"1")
               window.top.location.href = url
           }
           function addblue3() {
               var url = seturl(1,"2")
               window.top.location.href = url
           }
           function addblue4() {
               var url = seturl(1,"3")
               window.top.location.href = url
           }
           function addblue5() {
               var url = seturl(1,"4")
               window.top.location.href = url
           }
           */
           function checkArrayValue(sourceArray, targetArray) {
               let keys = []
               for (const item of sourceArray) {
                   if (targetArray.includes(item.toString())) {
                       keys.push(item)
                   }
               }
           
               if (keys.length == 0) {
                   return false
               }
           
               return keys;
           }
           
           function getTargetArrayValue(sourceArray, targetArray) {
           
               if (Array.isArray(sourceArray) == false) {
                   const [side, attribute] = sourceArray.split(":");
                   var return_value
                   if (attribute) {
                       return_value = targetArray[side] == attribute
                   } else {
                       return_value = targetArray[parseInt(sourceArray)]
                   }
                   if (typeof return_value == "undefined") {
                       return false
                   }
                   return return_value;
               }
           
               var return_value
           
               if (typeof sourceArray[0].split(":")[1] != "undefined") {
                   for (const item of sourceArray) {
                       const [side, attribute] = item.split(":");
                       if (attribute) {
                           return_value = targetArray[side] == attribute
                       } else {
                           return false
                       }
                       if (typeof return_value == "undefined") {
                           return false;
                       }
                   }
           
                   return return_value;
           
           
               }
           
               for (const item of sourceArray) {
                   return_value = targetArray[item]
                   if (typeof return_value == "undefined") {
                       return false;
                   }
               }
               return return_value;
           }
           
           
           function viewcustom() {
               if (custom.length == 0) {
                   return "无自定义配置"
               }
               const keyValuePairs = {};
               custom.forEach(item => {
                   const [key, value] = item.split(':');
                   keyValuePairs[key] = value;
               });
           
               console.log(keyValuePairs);
           
               const allcustom_str = []
           
               for (const key in mycustom_json) {
                   allcustom_str[key] = {}
                   const elements = mycustom_json[key];
                   const allcustom_str_table = allcustom_str[key]
           
                   for (const mkey in elements) {
           
                       const element = elements[mkey];
                       const keytable = element[0]
                       const valuetable = element[1]
           
           
                       const allcustom_str_mkey_table = []
                       let finalTrueResult = null;
           
                       for (let i = 0; i < keytable.length; i++) {
           
                           const element = keytable[i];
           
                           const result = getTargetArrayValue(element, keyValuePairs);
           
                           //i代表当前循环次数 可以通过i判断蓝红方
                           if (result === true) {
                               finalTrueResult = i + ":" + valuetable[i];
                           } else if (result !== false) {
                               const foundElement = i + ":" + valuetable[result];
                               allcustom_str_mkey_table.push(foundElement);
                           }
           
                       }
           
                       if (finalTrueResult !== null) {
                           allcustom_str_mkey_table.push(finalTrueResult);
                       }
           
           
                       if (allcustom_str_mkey_table.length > 0) {
                           allcustom_str_table[mkey] = allcustom_str_mkey_table
                       }
           
                   }
           
           
               }
           
           
           
               console.log(allcustom_str);
           
               return parseJsonData(allcustom_str, mapnametable[mapid][1] / 2);
           
           }
           
           function parseJsonData(json, param) {
               console.log(json)
               console.log(param)
               const result = {};
           
               // 解析英雄属性
               const heroAttributes = json["英雄属性"];
           
               let blueIndices = [];
               let redIndices = [];
           
               if (typeof param === 'undefined') {
                   param = 5
               }
               blueIndices = Array.from({ length: param }, (_, i) => i + 1);
               redIndices = Array.from({ length: param }, (_, i) => i + 1 + param);
           
               if (param != 5) {
           
                   for (const mkey in heroAttributes) {
                       const heroAttributes_element = heroAttributes[mkey]
                       for (let i = 0; i < heroAttributes_element.length; i++) {
                           const attribute = heroAttributes_element[i];
                           const colonIndex = attribute.indexOf(':');
           
                           if (colonIndex !== -1) {
                               const numberStr = attribute.substring(0, colonIndex);
                               const number = parseInt(numberStr, 10);
                               const prefix = attribute.substring(colonIndex + 1);
           
                               if (!isNaN(number)) {
           
                                   //如果小于指定数据长度跳过
                                   if (number < param) {
                                       continue
                                   }
           
                                   //如果小于指定数据长度跳过
                                   if (number < param * 2 - 1) {
                                       heroAttributes_element.splice(i, 1);
                                       i--;
                                       continue
                                   }
           
                                   //如果大于指定数据长度跳过
                                   if (number > 5 + param - 1) {
                                       heroAttributes_element.splice(i, 1);
                                       i--;
                                       continue
                                   }
           
           
                                   const newNumber = number - param + 1;
                                   heroAttributes_element[i] = `${newNumber}:${prefix}`;
                               }
                           }
                       }
           
                   }
           
                   console.log(heroAttributes)
               }
           
               const heroData = {};
           
               for (const [key, values] of Object.entries(heroAttributes)) {
                   values.forEach((value, index) => {
                       const [side, attribute] = value.split(":");
                       const heroIndex = parseInt(side) + 1;
           
           
                       if (!heroData[heroIndex]) {
                           heroData[heroIndex] = {};
                       }
           
                       if (!heroData[heroIndex][key]) {
                           heroData[heroIndex][key] = [];
                       }
           
                       heroData[heroIndex][key].push(attribute);
                   });
               }
           
               // 合并完全相等的数据
               const mergedHeroData = {};
               for (const heroIndex in heroData) {
                   const attributes = heroData[heroIndex];
                   const attrString = JSON.stringify(attributes);
                   if (!mergedHeroData[attrString]) {
                       mergedHeroData[attrString] = [];
                   }
                   mergedHeroData[attrString].push(heroIndex);
               }
           
               let SideOutput = "";
           
               for (const attributes in mergedHeroData) {
           
                   const attrObj = JSON.parse(attributes);
                   let customSideOutput = "";
                   for (const key in attrObj) {
                       customSideOutput += `${key}·${attrObj[key].join(', ')} `;
                   }
           
                   const allpostr = checkArrayValue([...blueIndices, ...redIndices], mergedHeroData[attributes])
                   if (allpostr) {
                       if (allpostr.length == param * 2) {
                           SideOutput += `全部阵营: `;
                           SideOutput += customSideOutput.trim() + "\n";
                           break
                       }
                   }
           
                   console.log(mergedHeroData)
           
                   const bluepostr = checkArrayValue(blueIndices, mergedHeroData[attributes])
                   if (bluepostr) {
                       if (bluepostr.length == param) {
                           SideOutput += `蓝方全部位置: `;
                           SideOutput += customSideOutput.trim() + "\n";
                       } else {
                           SideOutput += `蓝方位置 ${bluepostr.join(' ')} : `;
                           SideOutput += customSideOutput.trim() + "\n";
                       }
           
                   }
           
                   const redpostr = checkArrayValue(redIndices, mergedHeroData[attributes]);
                   if (redpostr) {
                       if (redpostr.length == param) {
                           SideOutput += `红方全部位置: `;
                           SideOutput += customSideOutput.trim() + "\n";
                       } else {
                           //重设位置 从1开始
                           SideOutput += `红方位置 ${redpostr.map(num => num - param).join(' ')} : `;
                           SideOutput += customSideOutput.trim() + "\n";
                       }
           
                   }
           
           
           
               }
           
               if (Object.keys(heroAttributes).length > 0) {
           
                   if (SideOutput.includes("全部阵营") == false) {
                       // 提取行并去除空行
                       const lines = SideOutput.trim().split('\n').filter(line => line);
           
                       // 解析每一行，提取信息
                       const parsedData = lines.map(line => {
                           const position = line.split(': ')[0];
                           const positionNumbers = position.match(/\d+/g); // 提取所有数字
                           let lastNumber
                           if (line.includes("全部位置")) {
                               //全部位置始终排在最前
                               lastNumber = 9999
                           } else {
                               lastNumber = parseInt(positionNumbers[positionNumbers.length - 1]); // 选择最后一个数字
                           }
                           const side = position.split('位置')[0]; // 蓝方或红方
           
                           return {
                               side,
                               location: lastNumber,
                               line: line,
                           };
                       });
           
                       // 先按蓝方和红方排序，然后按位置数字排序
                       const sortedData = parsedData.sort((a, b) => {
                           if (a.side.includes('蓝方') && b.side.includes('红方')) {
                               return -1; // 蓝方在红方前面
                           }
                           if (a.side.includes('红方') && b.side.includes('蓝方')) {
                               return 1; // 红方在蓝方后面
                           }
           
                           // 如果相同方，则按位置数字排序
                           return a.location - b.location;
                       });
           
                       SideOutput = sortedData.map(item => `${item.line}`).join('\n');
                   }
           
           
                   result["英雄属性"] = `英雄属性配置\n${SideOutput.trim()}`;
               }
           
               // 解析其他属性（兵线、水晶、防御塔、野怪）
               const otherAttributes = ["兵线属性", "水晶属性", "防御塔属性", "野怪属性"];
               otherAttributes.forEach(attr => {
                   const attrValue = json[attr];
                   const entries = Object.entries(attrValue);
           
                   if (entries.length == 0) {
                       return;
                   }
           
                   console.log(entries)
           
                   // 检查相同属性
                   const mergedAttrData = {};
                   entries.forEach(([key, value]) => {
                       const valueStr = JSON.stringify(value);
                       if (!mergedAttrData[valueStr]) {
                           mergedAttrData[valueStr] = [];
                       }
                       mergedAttrData[valueStr].push(key);
                   });
           
                   // 输出属性
                   console.log(mergedAttrData)
           
                   let blueLineOutput = ""
                   let redLineOutput = "";
                   for (const attrData in mergedAttrData) {
                       const attrKeys = mergedAttrData[attrData].join(', ');
                       const attrObj = JSON.parse(attrData);
                       console.log(mergedAttrData)
                       for (const side in attrObj) {
                           if (side === "0") {
                               blueLineOutput += `${attrKeys}: ${attrObj[side].split(":")[1]} `
                           } else {
                               redLineOutput += `${attrKeys}: ${attrObj[side].split(":")[1]} `
                           }
                       }
                   }
                   let Output = `${attr}配置\n`;
                   if (blueLineOutput != redLineOutput) {
                       Output += `蓝方: ${blueLineOutput.trim()}\n`;
                       Output += `红方: ${redLineOutput.trim()}`;
                   } else {
                       Output += `全部阵营: ${blueLineOutput}`;
                   }
           
                   result[attr] = Output.trim();
               });
           
           
               // 解析胜利条件
               const victoryCondition = json["胜利条件"];
               let victoryCondOutput = "胜利条件: ";
               if (victoryCondition["胜利条件"]) {
                   victoryCondOutput += `${victoryCondition["胜利条件"][0].split(":")[1]}\n`;
                   result["胜利条件"] = victoryCondOutput.trim();
               }
           
           
           
               // 将结果合并为一个字符串
               let finalOutput = "";
               for (const key in result) {
                   finalOutput += result[key] + "\n";
               }
           
               return finalOutput.trim();
           }
           
           function viewbanhero() {
               if (banheros.length == 0) {
                   return "无禁用英雄配置"
               }
               let allheros = mydatajson[1]
               const banheros_name = []
               for (let key in allheros) {
                   const element = allheros[key];
                   const myvalue = element.split('|', 1)[0];
                   if (banheros.includes(myvalue)) {
                       banheros_name.push(key)
                   }
               }
               return banheros_name.join(' ')
           
           }
           
           alltip[1].innerText = viewcustom()
           alltip[2].innerText = viewbanhero()

           
           
           function home() {
               window.top.location.replace(window.location.origin + "/")
           }
           
           
           function qun() {
               window.top.location.href = "https://qun.qq.com/universal-share/share?ac=1&authKey=ooyk6D55eIiw9y2%2FCNKtoApNIvdTQsNIvBM7LHkOzG9PEdBcn0MEfrXrJswcgthQ&busi_data=eyJncm91cENvZGUiOiIxMDM2NDIxNDA0IiwidG9rZW4iOiJPUXkybENnTWNPQ2QvaHMzMWhHSE9kUXprZklncGkxS3NkVDZBa1NZTHZnRkFFWjIvQUlyWEQ2VjdpbHI4NWlwIiwidWluIjoiMjgyNjMzNDMxIn0%3D&data=bJ8Hr-l1zBBw1suLzkmybI0fht_UO-ZW33hn020M6xOX_HhY4zyyWBEnxfn6YGXouvHIRKEAtr3WAVqysjKUvw&svctype=4&tempid=h5_group_info"
           }
    function exitRoom() {
    const 正式服scheme协议 = "tencentmsdk1104466820://";
    const 体验服scheme协议 = "tencentmsdk1104791911://";
    const 国际服scheme协议 = "tencent102083272://"
    const 退出房间参数 = "?gamedata=SmobaLaunch_AAAA";
    
    
    if(gametype === "正式服") {
        if (navigator.userAgent.indexOf("QQ/") !== -1) {
        window.top.location.href = "https://h5.nes.smoba.qq.com/pvpesport.web.user/#/launch-game-mp-qq" + 退出房间参数;
       }
    else {
    window.top.location.href = 正式服scheme协议 + 退出房间参数;
    }
    }
    else if (gametype === "体验服") {
    	window.top.location.href = 体验服scheme协议 + 退出房间参数
    }
    else if (gametype === "国际服") {
        window.top.location.href = 国际服scheme协议 + 退出房间参数
        }
        else {
        	alert("未识别到游戏");
        }
}


           
      </script>
   </body>
</html>
